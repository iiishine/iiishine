<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>{{{ event_text('page_title') }}}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    {{ HTML::style('css/style.css') }}
    <link rel="stylesheet" href="{{ asset('donghua/css/style.css') }}">
</head>
<body>
<div id="body">
    <div style="display: none;">
      <img src="{{ asset('donghua/images/mask1.png') }} " />
      <img src="{{ asset('donghua/images/mask2.png') }} " />
      <img src="{{ asset('donghua/images/mask3.png') }} " />
      <img src="{{ asset('donghua/images/mask4.png') }} " />
      <img src="{{ asset('donghua/images/mask5.png') }} " />
      <img src="{{ asset('donghua/images/mask6.png') }} " />
      <img src="{{ asset('donghua/images/mask7.png') }} " />
    </div>
    <div id="body">
      <!-- 4 6 2 7 3 5 1 -->
      <div class="topbar">
        <a class="btnrule" id="btnRules" href="#"></a>
        <a class="btndiscounts" href="http://gkx.me/bquMnq"></a>

        <img class="logo" src="{{ asset('donghua/images/logo.png') }} " />
      </div>
      <div class="lightning-wrapper">
        <div class="lightning l1"></div>
        <div class="lightning l2"></div>
        <div class="lightning l3"></div>
        <div class="lightning l4"></div>
        <div class="lightning l5"></div>
        <div class="lightning l6"></div>
        <div class="lightning l7"></div>
      </div>

      <div class="content">
        <div class='people'>
          <img class="peopleimg" src="{{ asset('donghua/images/people.gif') }} " />
          <img class="tagimg" src="{{ asset('donghua/images/tag.png') }} " />
        </div>
        <img class="bag" src="{{ asset('donghua/images/money-bag.png') }} " />
      </div>
      <div class="callout">
        <div class="prize callout-item">
          <img class="bgimg" src="{{ asset('donghua/images/prize.png') }} " />
          <div class="shop-logo">
            <img src="{{ $prize->image }}">
          </div>
          <div class="prize-content">
            <div class="price">{{ $prize->name }}</div>
            <div class="explain">{{ $prize->merchant_intro }}</div>
          </div>
        </div>
        @if($customer->isMember())
          <a class="btnget callout-item" href="#">
            <img src="{{ asset('donghua/images/btn-get.png') }}" />
            <div class="btn-content btn-share"><span>{{ event_text('btn_again_receive') }}</span></div>
          </a>
        @else
          <a class="btnget callout-item" href="{{ url('commonreg/reg') }}">
            <img src="{{ asset('donghua/images/btn-get.png') }}" />
            <div class="btn-content"><span>{{ event_text('btn_again_receive') }}</span></div>
          </a>
        @endif
      </div>
    </div>
</div>

<div id="rulesPopup" class="tc">
    <div class="tcmain">
        <a href="#" id="btnRulesClose" class="close"><img src="{{ asset('images/close.png') }}" alt=""></a>
        <div class="srule">{{ event_text('rules_body') }}</div>
    </div>
</div>

<div id="sharePopup" class="tc2">
    <div class="tcmain"></div>
</div>

<script src="{{ asset('vendor/jquery-2.1.1.min.js') }}" type="text/javascript"></script>
<script src="{{ asset('donghua/js/lodash.min.js') }}" type="text/javascript"></script>
<script src="{{ asset('donghua/js/velocity.min.js') }}" type="text/javascript"></script>
<script src="{{ asset('donghua/js/velocity.ui.js') }}" type="text/javascript"></script>

<script>
    $(function(){
        var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
        var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        $('body, #body').height(h);

        var arr = [4,6,2,7,3,5,1];
        var index = 0;
        var timer = setInterval(function(){
          if (index === 7) {
            clearInterval(timer);
            $('.lightning-wrapper').addClass('showall');
            return;
          }
          $('.lightning-wrapper').removeClass('show1 show2 show3 show4 show5 show6 show7').addClass('show' + arr[index]);
          ++index;
        }, 100);

        $('.content .people').css({
          top: -parseInt(w/2)-2
        });
        $('.content').velocity({
          translateY: "-780px"
        }, { delay: 1000});

        var boxShadows = ['0 0 20px 20px #fff', '0 0 22px 22px #fff', '0 0 25px 25px #fff', '0 0 14px 14px #fff', '0 0 40px 40px #fff'];
        var fls = [2,0,2,0,4,1,1,1,0,5];
        var coins = [4,0,2,8,12,16,16];
        setTimeout(function(){
          var fltimer = setInterval(function(){
            if (fls.length === 0) {
              $('.flashlight').remove();
              clearInterval(fltimer);
              return;
            }
            //$('.flashlight').remove();
            var num = fls.shift();
            if (num === 0) {
              $('.flashlight').remove();
              return;
            }
            _.times(num, function(){
              $('<div class="flashlight"></div>').css({
                top: _.random(-100, 100),
                left: _.random(-5, w+5),
                'boxShadow': _.sample(boxShadows)
              }).appendTo($('.content'));
            });
          }, 100);

          var cointimer = setInterval(function(){
            if (coins.length === 0) {
              clearInterval(cointimer);
              return;
            }
            var num = coins.shift();
            _.times(num, function(){
              $('<div class="coin"></div>').css({
                top: _.random(-100, 100),
                left: _.random(-5, w+5)
              }).appendTo($('.content'));
            });
            if (coins.length === 2) {
              $('<div class="coin2"></div>').appendTo($('#body'));
              $('<div class="coin4"></div>').appendTo($('.content'));
            }
          }, 100);
        }, 1200);

        $('.content .people').velocity('fadeIn', { duration: 200, delay: 2000});
        setTimeout(function(){
          $('.prize-content').height($('.callout .prize').height() - 10);
          $('.btn-content').height($('.btnget').height()-4);
          $('.callout .callout-item').velocity('transition.slideUpIn', {display: 'inline-block',stagger:150});
          $('.tagimg').show();
          $('.topbar a').velocity('transition.slideDownIn', {stagger:50});
        }, 2600);

        $('.btn-share').click(function(event) {
            event.preventDefault();
            $('#sharePopup').show();
        });
        $('#sharePopup').on('click', function() {
            $(this).hide();
        });

        $('#btnRules').click(function(event) {
            event.preventDefault();
            $('#rulesPopup').show();
        });
        $('#btnRulesClose').click(function(event) {
            event.preventDefault();
            $('#rulesPopup').hide();
        });
    });
</script>

<script>{{ JS::renderObj('app') }}</script>
{{ HTML::script('js/larapp.js') }}
{{ JS::renderScripts() }}
<script type="text/javascript" charset="utf-8">
  $(function() {
    app.setupClickTrack();
  });
</script>

<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8">
  wx.config(<?php echo $wechatJs->config(array('onMenuShareTimeline', 'onMenuShareAppMessage'), false, true) ?>);
  wx.ready(function() {
    var shareData = {
      title: '{{ event_text('wechat_share_title') }}',
      desc: '{{ event_text('wechat_share_description') }}',
      link: '{{ url('') }}',
      imgUrl: '{{ $shareres->mobile->image }}'
    };

    shareData.success = function() {
      window.location.href = '{{ url('prize/share') }}';
    };

    wx.onMenuShareAppMessage(shareData);
    wx.onMenuShareTimeline(shareData);
  });
</script>

{{ $trackcode }}
</body>
</html>
